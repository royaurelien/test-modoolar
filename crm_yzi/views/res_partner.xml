<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <!-- FORM -->
    <record id="crm_res_partner_inherit" model="ir.ui.view">
        <field name="name">Partner</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">

            <xpath expr="//sheet/group" position="after">
                <group>
                    <group>
                        <field name='effectif' attrs="{'invisible': [('is_company','=', False)]}"/>
                        <field name='annee_effectif' attrs="{'invisible': [('is_company','=', False)]}"/>

                        <field name='chiffre_affaire' attrs="{'invisible': [('is_company','=', False)]}"/>
                        <field name='annee_chiffre_affaire' attrs="{'invisible': [('is_company','=', False)]}"/>
                    </group>
                    <group>
                        <field name='dernier_devis' attrs="{'invisible':[('is_company','=', False)]}"/>
                        <field name='type_rel' attrs="{'invisible': [('is_company','=', False)]}"/>
                        <!--<field name='service_informatique' attrs="{'invisible': [('is_company','=', False)]}"/>-->
                        <field name='tag_ids' attrs="{'invisible': [('is_company','=', False)]}" widget="many2many_tags"/>
                    </group>
                </group>
            </xpath>

            <xpath expr="//field[@name='vat']" position="attributes">
                <attribute name="attrs">{'required': [('type_rel','=','client')]}</attribute>
            </xpath>

        </field>
    </record>

    <!--SEARCH-->
    <record id="crm_res_partner_search_inherit" model="ir.ui.view">
        <field name="name">Partner</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_res_partner_filter"/>
        <field name="arch" type="xml">

            <xpath expr="//filter[@name='customer']" position="after">
                <filter string="Clients négligés" name="neglected customer" domain="['|',
                ('last_action', '&lt;', (context_today()-relativedelta(days=60)).strftime('%Y-%m-%d')),('dernier_devis', '&lt;', (context_today()-relativedelta(days=60)).strftime('%Y-%m-%d'))]"/>
                <filter string="Prospects négligés" name="neglected prospect" domain="[('last_action', '&lt;', (context_today()-relativedelta(days=60)).strftime('%Y-%m-%d'))]"/>

            </xpath>
        </field>
    </record>

    <!--Actions des menus-->
    <record id="crm_action_partner_form" model="ir.actions.act_window">
        <field name="name">Comptes</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_type">form</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="context">
            {
            "search_default_type_company":1
            }
        </field>
        <field name="search_view_id" ref="base.view_res_partner_filter"/>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Click to add a contact in your address book.
            </p><p>
            Odoo helps you easily track all activities related to
            a customer: discussions, history of business opportunities,
            documents, etc.
        </p>
        </field>
    </record>
    <record id="crm_action_partner_form_customer" model="ir.actions.act_window">
        <field name="name">Clients</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_type">form</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="context">
            {
            "search_default_customer":1,
            "search_default_type_company":1
            }
        </field>
        <field name="domain">[u'|', [u'type_rel', u'=', u'Client'], [u'type_rel', u'=', u'Ancien Client']]</field>
        <field name="search_view_id" ref="base.view_res_partner_filter"/>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Click to add a contact in your address book.
            </p><p>
            Odoo helps you easily track all activities related to
            a customer: discussions, history of business opportunities,
            documents, etc.
        </p>
        </field>
    </record>
    <record id="crm_action_partner_form_prospect" model="ir.actions.act_window">
        <field name="name">Prospects</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_type">form</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="context">
            {
            "search_default_type_company":1
            }
        </field>
        <field name="domain">[[u'type_rel', u'=', u'Prospect']]</field>
        <field name="search_view_id" ref="base.view_res_partner_filter"/>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Click to add a contact in your address book.
            </p><p>
            Odoo helps you easily track all activities related to
            a customer: discussions, history of business opportunities,
            documents, etc.
        </p>
        </field>
    </record>
    <record id="crm_action_partner_form_partner" model="ir.actions.act_window">
        <field name="name">Tiers</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_type">form</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="context">
            {
            "search_default_customer":1,
            "search_default_type_company":1,
            "search_default_type_rel":"Tier"
            }
        </field>
        <field name="domain">[[u'type_rel', u'=', u'Tier']]</field>
        <field name="search_view_id" ref="base.view_res_partner_filter"/>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Click to add a contact in your address book.
            </p><p>
            Odoo helps you easily track all activities related to
            a customer: discussions, history of business opportunities,
            documents, etc.
        </p>
        </field>
    </record>
        <record id="crm_action_partner_form_supplier" model="ir.actions.act_window">
        <field name="name">Fournisseurs</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_type">form</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="context">
            {
            "search_default_customer":1,
            "search_default_type_company":1,
            "search_default_type_rel":"Fournisseur"
            }
        </field>
        <field name="domain">[[u'type_rel', u'=', u'Fournisseur']]</field>
        <field name="search_view_id" ref="base.view_res_partner_filter"/>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Click to add a contact in your address book.
            </p><p>
            Odoo helps you easily track all activities related to
            a customer: discussions, history of business opportunities,
            documents, etc.
        </p>
        </field>
    </record>
    <record id="crm_action_partner_form_concurrent" model="ir.actions.act_window">
        <field name="name">Concurrents</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_type">form</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="context">
            {
            "search_default_customer":1,
            "search_default_type_company":1,
            "search_default_type_rel":"concurrent"
            }
        </field>
        <field name="domain">[[u'type_rel', u'=', u'Concurrent']]</field>
        <field name="search_view_id" ref="base.view_res_partner_filter"/>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Click to add a contact in your address book.
            </p><p>
            Odoo helps you easily track all activities related to
            a customer: discussions, history of business opportunities,
            documents, etc.
        </p>
        </field>
    </record>
    <record id="crm_action_partner_form_contact" model="ir.actions.act_window">
        <field name="name">Contacts</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_type">form</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="context">{"search_default_customer":1, "search_default_type_person":1}</field>
        <field name="search_view_id" ref="base.view_res_partner_filter"/>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Click to add a contact in your address book.
            </p><p>
            Odoo helps you easily track all activities related to
            a customer: discussions, history of business opportunities,
            documents, etc.
        </p>
        </field>
    </record>

    <!-- Menu principaux-->
    <menuitem id="crm.res_partner_menu_crm" parent="crm.crm_menu_root" name="Comptes"/>
    <menuitem id="menu_contact" name="Contacts" parent="crm.res_partner_menu_crm" action="crm_action_partner_form_contact" sequence="4"/>

    <!--Sous Menu compte-->
    <menuitem id="sous_menu_prospect" name="Prospects" parent="crm.res_partner_menu_crm" action="crm_action_partner_form_prospect" sequence="1"/>
    <menuitem id="sous_menu_customer" name="Clients" parent="crm.res_partner_menu_crm" action="crm_action_partner_form_customer" sequence="2"/>
    <menuitem id="sous_menu_partnaires" name="Tiers" parent="crm.res_partner_menu_crm" action="crm_action_partner_form_partner" sequence="3"/>
    <menuitem id="sous_menu_fournisseur" name="Fournisseurs" parent="crm.res_partner_menu_crm" action="crm_action_partner_form_supplier" sequence="4"/>
    <menuitem id="sous_menu_concurrents" name="Concurrents" parent="crm.res_partner_menu_crm" action="crm_action_partner_form_concurrent" sequence="5"/>
    <menuitem id="sous_menu_compte" name="Tous les Comptes" parent="crm.res_partner_menu_crm" action="crm_action_partner_form" sequence="6"/>



</odoo>
