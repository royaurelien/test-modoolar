<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <record model="ir.ui.view" id="mail_activity_tree_view">
        <field name="name">Activités</field>
        <field name="model">mail.activity</field>
        <field name="arch" type="xml">
            <tree>
                <field name="activity_type_id" string="Type"/>
                <field name="summary" string="Résumé"/>
                <field name="res_name" string="Document"/>
                <field name="date_deadline" string="Date d'échéance"/>
                <field name="user_id" string="Assignée à"/>
                <field name="state" string="Etat" attrs="{'invisible':[('archived','=',True)]}"/>
                <field name="archived" string="Archivée"/>
            </tree>
        </field>
    </record>

    <record id="mail_activity_search_view" model="ir.ui.view">
        <field name="name">Filtres</field>
        <field name="model">mail.activity</field>
        <field name="arch" type="xml">
            <search>
                <!-- Field -->
                <field name="state"/>
                <field name="archived"/>
                <field name="activity_type_id"/>

                <!-- Group by -->
                <group expand="0" string="Group by">
                    <filter name="grp_by_type" string="Type" context="{'group_by': 'activity_type_id'}"/>
                </group>

                    <filter string="Activités en cours" name="currently" domain="[('archived','!=', True)]"/>
                    <filter string="Activités archivées" name="ended" domain="[('archived','=', True)]"/>

                    <separator/>

                    <filter string="Activités planifiées" name="planned" domain="[('archived','!=', True),('date_deadline','&gt;', context_today().strftime('%Y-%m-%d'))]"/>
                    <filter string="Activités aujourd'hui" name="today" domain="[('archived','!=', True),('date_deadline','=', context_today().strftime('%Y-%m-%d'))]"/>
                    <filter string="Activités en retard" name="overdue" domain="[('archived','!=', True),('date_deadline','&lt;', context_today().strftime('%Y-%m-%d'))]"/>
            </search>
        </field>
    </record>

    <record model="ir.actions.act_window" id="mail_activity_tree_view_action">
        <field name="name">Activités</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mail.activity</field>
        <field name="view_mode">tree, form</field>
        <field name="view_id" ref="mail_activity_tree_view"/>
        <field name="search_view_id" ref="mail_activity_search_view"/>
        <field name="domain">
            [('user_id','=', uid)]
        </field>
        <field name="target">current</field>
   </record>

   <menuitem id="menu_activites_tree" parent="crm.crm_menu_root" name="Activités" action="mail_activity_tree_view_action"/>




    <record id="account_search_view_for_activities" model="ir.ui.view">
        <field name="name">Filtres</field>
        <field name="model">account.invoice</field>
        <field name="inherit_id" ref="account.view_account_invoice_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//search/filter[@name='activities_overdue']" position="replace">
                <filter string="Activités en retard" name="activities_overdue" domain="[('activity_ids.date_deadline', '&lt;', context_today().strftime('%Y-%m-%d')), ('activity_ids.archived', '!=', True)]" help="Show all records which has next action date is before today"/>
            </xpath>
            <xpath expr="//search/filter[@name='activities_today']" position="replace">
                <filter string="Activités du jour" name="activities_today" domain="[('activity_ids.date_deadline', '=', context_today().strftime('%Y-%m-%d')), ('activity_ids.archived', '!=', True)]"/>
            </xpath>
            <xpath expr="//search/filter[@name='activities_upcoming_all']" position="replace">
                      <filter string="Activités futuressss" name="activities_upcoming_all" domain="[('activity_ids.date_deadline', '&gt;', context_today().strftime('%Y-%m-%d')), ('activity_ids.archived', '!=', True)]"/>
            </xpath>
            <xpath expr="//search/filter[@name='activities_my']" position="replace">
                <filter string="Mes activités" name="activities_my" domain="[('activity_ids.user_id', '=', uid), ('activity_ids.archived', '!=', True)]"/>
            </xpath>
        </field>
    </record>

    <record id="account_search_view_for_activities2" model="ir.ui.view">
        <field name="name">Filtres</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_internal_search"/>
        <field name="arch" type="xml">
            <xpath expr="//search/filter[@name='activities_overdue']" position="replace">
                <filter string="Activités en retard" name="activities_overdue" domain="[('activity_ids.date_deadline', '&lt;', context_today().strftime('%Y-%m-%d')), ('activity_ids.archived', '!=', True)]" help="Show all records which has next action date is before today"/>
            </xpath>
            <xpath expr="//search/filter[@name='activities_today']" position="replace">
                <filter string="Activités du jour" name="activities_today" domain="[('activity_ids.date_deadline', '=', context_today().strftime('%Y-%m-%d')), ('activity_ids.archived', '!=', True)]"/>
            </xpath>
            <xpath expr="//search/filter[@name='activities_upcoming_all']" position="replace">
                      <filter string="Activités futuressss" name="activities_upcoming_all" domain="[('activity_ids.date_deadline', '&gt;', context_today().strftime('%Y-%m-%d')), ('activity_ids.archived', '!=', True)]"/>
            </xpath>
            <xpath expr="//search/filter[@name='activities_my']" position="replace">
                <filter string="Mes activités" name="activities_my" domain="[('activity_ids.user_id', '=', uid), ('activity_ids.archived', '!=', True)]"/>
            </xpath>
        </field>
    </record>

    <record id="account_search_view_for_activities3" model="ir.ui.view">
        <field name="name">Filtres</field>
        <field name="model">purchase.order</field>
        <field name="inherit_id" ref="purchase.view_purchase_order_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//search/filter[@name='activities_overdue']" position="replace">
                <filter string="Activités en retard" name="activities_overdue" domain="[('activity_ids.date_deadline', '&lt;', context_today().strftime('%Y-%m-%d')), ('activity_ids.archived', '!=', True)]" help="Show all records which has next action date is before today"/>
            </xpath>
            <xpath expr="//search/filter[@name='activities_today']" position="replace">
                <filter string="Activités du jour" name="activities_today" domain="[('activity_ids.date_deadline', '=', context_today().strftime('%Y-%m-%d')), ('activity_ids.archived', '!=', True)]"/>
            </xpath>
            <xpath expr="//search/filter[@name='activities_upcoming_all']" position="replace">
                      <filter string="Activités futuressss" name="activities_upcoming_all" domain="[('activity_ids.date_deadline', '&gt;', context_today().strftime('%Y-%m-%d')), ('activity_ids.archived', '!=', True)]"/>
            </xpath>
            <xpath expr="//search/filter[@name='activities_my']" position="replace">
                <filter string="Mes activités" name="activities_my" domain="[('activity_ids.user_id', '=', uid), ('activity_ids.archived', '!=', True)]"/>
            </xpath>
        </field>
    </record>

    <record id="account_search_view_for_activities4" model="ir.ui.view">
        <field name="name">Filtres</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_sales_order_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//search/filter[@name='activities_overdue']" position="replace">
                <filter string="Activités en retard" name="activities_overdue" domain="[('activity_ids.date_deadline', '&lt;', context_today().strftime('%Y-%m-%d')), ('activity_ids.archived', '!=', True)]" help="Show all records which has next action date is before today"/>
            </xpath>
            <xpath expr="//search/filter[@name='activities_today']" position="replace">
                <filter string="Activités du jour" name="activities_today" domain="[('activity_ids.date_deadline', '=', context_today().strftime('%Y-%m-%d')), ('activity_ids.archived', '!=', True)]"/>
            </xpath>
            <xpath expr="//search/filter[@name='activities_upcoming_all']" position="replace">
                      <filter string="Activités futuressss" name="activities_upcoming_all" domain="[('activity_ids.date_deadline', '&gt;', context_today().strftime('%Y-%m-%d')), ('activity_ids.archived', '!=', True)]"/>
            </xpath>
            <xpath expr="//search/filter[@name='activities_my']" position="replace">
                <filter string="Mes activités" name="activities_my" domain="[('activity_ids.user_id', '=', uid), ('activity_ids.archived', '!=', True)]"/>
            </xpath>
        </field>
    </record>

    <record id="account_search_view_for_activities5" model="ir.ui.view">
        <field name="name">Filtres</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="mail.res_partner_view_search_inherit_mail"/>
        <field name="arch" type="xml">
            <xpath expr="//search/filter[@name='activities_overdue']" position="replace">
                <filter string="Activités en retard" name="activities_overdue" domain="[('activity_ids.date_deadline', '&lt;', context_today().strftime('%Y-%m-%d')), ('activity_ids.archived', '!=', True)]" help="Show all records which has next action date is before today"/>
            </xpath>
            <xpath expr="//search/filter[@name='activities_today']" position="replace">
                <filter string="Activités du jour" name="activities_today" domain="[('activity_ids.date_deadline', '=', context_today().strftime('%Y-%m-%d')), ('activity_ids.archived', '!=', True)]"/>
            </xpath>
            <xpath expr="//search/filter[@name='activities_upcoming_all']" position="replace">
                      <filter string="Activités futuressss" name="activities_upcoming_all" domain="[('activity_ids.date_deadline', '&gt;', context_today().strftime('%Y-%m-%d')), ('activity_ids.archived', '!=', True)]"/>
            </xpath>
            <xpath expr="//search/filter[@name='activities_my']" position="replace">
                <filter string="Mes activités" name="activities_my" domain="[('activity_ids.user_id', '=', uid), ('activity_ids.archived', '!=', True)]"/>
            </xpath>
        </field>
    </record>

     <record id="account_search_view_for_activities6" model="ir.ui.view">
        <field name="name">Filtres</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.view_crm_case_opportunities_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//search/filter[@name='activities_overdue']" position="replace">
                <filter string="Activités en retard" name="activities_overdue" domain="[('activity_ids.date_deadline', '&lt;', context_today().strftime('%Y-%m-%d')), ('activity_ids.archived', '!=', True)]" help="Show all records which has next action date is before today"/>
            </xpath>
            <xpath expr="//search/filter[@name='activities_today']" position="replace">
                <filter string="Activités du jour" name="activities_today" domain="[('activity_ids.date_deadline', '=', context_today().strftime('%Y-%m-%d')), ('activity_ids.archived', '!=', True)]"/>
            </xpath>
            <xpath expr="//search/filter[@name='activities_upcoming_all']" position="replace">
                      <filter string="Activités futuressss" name="activities_upcoming_all" domain="[('activity_ids.date_deadline', '&gt;', context_today().strftime('%Y-%m-%d')), ('activity_ids.archived', '!=', True)]"/>
            </xpath>
            <xpath expr="//search/filter[@name='activities_my']" position="replace">
                <filter string="Mes activités" name="activities_my" domain="[('activity_ids.user_id', '=', uid), ('activity_ids.archived', '!=', True)]"/>
            </xpath>
        </field>
    </record>

    <record id="account_search_view_for_activities7" model="ir.ui.view">
        <field name="name">Filtres</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="
        crm.view_crm_case_leads_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//search/filter[@name='activities_overdue']" position="replace">
                <filter string="Activités en retard" name="activities_overdue" domain="[('activity_ids.date_deadline', '&lt;', context_today().strftime('%Y-%m-%d')), ('activity_ids.archived', '!=', True)]" help="Show all records which has next action date is before today"/>
            </xpath>
            <xpath expr="//search/filter[@name='activities_today']" position="replace">
                <filter string="Activités du jour" name="activities_today" domain="[('activity_ids.date_deadline', '=', context_today().strftime('%Y-%m-%d')), ('activity_ids.archived', '!=', True)]"/>
            </xpath>
            <xpath expr="//search/filter[@name='activities_week']" position="replace">
                <filter string="Future Activities (7 dayssss)" name="activities_week" domain="['&amp;', ('activity_ids.date_deadline', '&gt;=', context_today().strftime('%Y-%m-%d')),('activity_ids.date_deadline', '&lt;=', (context_today()+datetime.timedelta(days=7)).strftime('%Y-%m-%d')), ('activity_ids.archived', '!=', True)]"/>
            </xpath>
            <xpath expr="//search/filter[@name='activities_upcoming_all']" position="replace">
                    <filter string="Future Activities (All)" name="activities_upcoming_all" domain="[('activity_ids.date_deadline', '&gt;', context_today().strftime('%Y-%m-%d')), ('activity_ids.archived', '!=', True)]"/>
            </xpath>
            <xpath expr="//search/filter[@name='activities_my']" position="replace">
                <filter string="Mes activités" name="activities_my" domain="[('activity_ids.user_id', '=', uid), ('activity_ids.archived', '!=', True)]"/>
            </xpath>
        </field>
    </record>

</odoo>