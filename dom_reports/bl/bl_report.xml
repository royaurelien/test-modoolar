
<odoo>
    <!-- BL -->
    <template id="dom_report_bl_document">
        <t t-call="dom_reports.external_layout">
            <t t-set="doc" t-value="doc.with_context({'lang':doc.partner_id.lang})" />
            <div class="page">
                <div class="oe_structure"/>

                <t t-call="dom_reports.upper_part" />

                <table class="table-curved lines-table">
                    <thead>
                        <tr>
                            <th>REFERENCE</th>
                            <th>DESIGNATION</th>
                            <th>QTE</th>
                            <!--<th>CONDT</th>-->
                            <th>POIDS</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr t-foreach="doc.move_lines" t-as="move">
                            <td class="left-align">
                                <span t-field="move.product_id.default_code"/>
                            </td>
                            <td class="left-align">
                                <span t-field="move.product_id.name"/>
                            </td>
                            <td>
                                <!--span t-field="move.quantity_done"/>
                                <span t-field="move.product_uom"/-->
                                <t t-set="qty" t-value="move.quantity_done"/>
                                <span t-esc="int(qty) if qty.is_integer() else qty"/>
                            </td>
                            <!--<td>
                                <span t-field="move.product_uom"/>
                            </td>-->
                            <td>
                                <span t-esc="'%.2f'%(move.product_id.weight * move.quantity_done)"/>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div class="row">
                    <div class="col-xs-6">
                        Remarque :
                    </div>

                    <div class="col-xs-6">
                        NB LIVRAISON :
                        <t t-if="doc.partner_id.horaires_livraison">
                            <span t-field="doc.partner_id.horaires_livraison"/>
                        </t>
                        <t t-else="">
                            <span t-field="doc.partner_id.parent_id.horaires_livraison"/>
                        </t>

                    </div>
                </div>

                <div class="bl-spacer-div"></div>

                <!-- summary table -->
                <div class="row bl-summary-line">
                    <t t-set="err_mess">
                        <p> Odoo n'est pas configuré pour la gestion des colis. </p>
                    </t>
                    <div class="col-xs-4">
                        <!--
                        <t t-if=" 'package_ids' in doc.fields_get() ">
                            <p> Nombre de carton : <span t-esc="len(doc.package_ids.ids)"/> </p>
                        </t> -->
                        <t t-if=" 'nb_cartons' in doc.fields_get() ">
                            <p> Nombre de cartons : <span t-esc="doc.nb_cartons"/> </p>
                        </t>
                        <t t-else="">
                            <t t-raw="err_mess" /> <p>(champ package_ids inexistant)</p>
                        </t>
                        <!--<p> Nombre de carton : <span t-field="doc.package_ids"/> </p>-->
                    </div>
                    <div class="col-xs-4">
                        <p> Total Quantité : <span t-esc="'%.2f'%(sum([x.quantity_done for x in doc.move_lines]))"/> </p>
                    </div>
                    <div class="col-xs-4">
                        <t t-if=" 'shipping_weight' in doc.fields_get() ">
                            <p> Total Poids Brut : <span t-field="doc.shipping_weight"/> <span t-field="doc.weight_uom_id"/> </p>
                        </t>
                        <t t-else="">
                            <t t-raw="err_mess" /> <p>(champ shipping_weight inexistant)</p>
                        </t>
                    </div>
                </div>

                <div class="row">
                    <div class="col-xs-12">
                        <p class="invoice-warning-two">
                            La présente vente est conclue en application des conditions générales de vente figurant au verso du document
                        </p>
                    </div>
                </div>

            </div>
        </t>
    </template>

    <template id="dom_report_bl">
        <t t-call="web.html_container">
            <t t-set="bl" t-value="True"/>
            <t t-foreach="docs" t-as="doc">
                <t t-call="dom_reports.dom_report_bl_document" t-lang="doc.partner_id.lang"/>
            </t>
        </t>
    </template>

    <!-- BL VALO -->

    <template id="dom_report_bl_document_valo">
        <t t-call="dom_reports.external_layout">
            <t t-set="doc" t-value="doc.with_context({'lang':doc.partner_id.lang})" />
            <div class="page">
                <div class="oe_structure"/>

                <t t-call="dom_reports.upper_part" />

                <table class="table-curved lines-table">
                    <thead>
                        <tr>
                            <th>REFERENCE</th>
                            <th>DESIGNATION</th>
                            <th>QTE</th>
                            <!--<th>CONDT</th>-->
                            <th>POIDS</th>
                            <th>PU HT</th>
                            <th>REM %</th>
                            <th>PU NET</th>
                            <th>MONTANT</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr t-foreach="doc.move_lines" t-as="move">
                            <td class="left-align">
                                <span t-field="move.product_id.default_code"/>
                            </td>
                            <td class="left-align">
                                <span t-field="move.product_id.name"/>
                            </td>
                            <td>
                                <!--span t-field="move.quantity_done"/>
                                <span t-field="move.product_uom"/-->
                                <t t-set="qty" t-value="move.quantity_done"/>
                                <span t-esc="int(qty) if qty.is_integer() else qty"/>
                            </td>
                            <!--<td>
                                <span t-field="move.product_uom"/>
                            </td>-->
                            <td>
                                <span t-esc="'%.2f'%(move.product_id.weight * move.quantity_done)"/>
                            </td>
                            <td>
                                <t t-if="move.sale_line_id">
                                    <span t-esc="'%.2f'%(move.sale_line_id.price_unit)"/>
                                </t>
                            </td>
                            <td>
                                <t t-if="move.sale_line_id">
                                    <span t-esc="move.sale_line_id.discount"/>
                                </t>
                            </td>
                            <td>
                                <t t-if="move.sale_line_id">
                                    <span t-esc="'%.2f'%(move.sale_line_id.price_subtotal_net)"/>
                                </t>
                            </td>
                            <td>
                                <t t-if="move.sale_line_id">
                                    <span t-esc="'%.2f'%(move.sale_line_id.price_total)"/>
                                </t>
                            </td>

                        </tr>
                    </tbody>
                </table>
                <table class="table-curved summary-table">
                    <thead>
                        <tr>
                            <!--<th>BASES HT</th>-->
                            <th t-if="doc.sale_id.remise.amount">REMISE</th>
                            <th>PORT HT</th>
                            <th style="white-space: normal;">
                                DECONDITIONNEMENT
                            </th>
                            <th>TOTAL HT NET</th>
                            <th>% TVA</th>
                            <th>MT TVA</th>
                            <th>TOTAUX</th>
                            <th>Net à Payer</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>

                            <!-- remise globale -->
                            <td t-if="doc.sale_id.remise">
                                <span t-esc="str(int(doc.remise.amount)) if doc.remise.amount.is_integer() else str(doc.remise.amount)" />%
                                <br/>
                                <!-- valeur remise globale -->
                                <span t-esc="doc.sale_id.amount_ht_net*(doc.remise.amount/100)"
                                      t-options='{"widget": "monetary", "display_currency": doc.sale_id.currency_id}'/>
                            </td>
                            <!-- port -->
                            <td>
                                <t t-if="doc.sale_id">
                                    <t t-foreach="doc.sale_id.order_line" t-as="l">
                                        <t t-if="l.is_delivery">
                                            <span t-field="l.price_subtotal_net"
                                                  t-options='{"widget": "monetary", "display_currency": doc.sale_id.pricelist_id.currency_id}'/>
                                        </t>
                                    </t>
                                </t>
                            </td>
                            <td>
                                <t t-if="doc.sale_id">
                                    <t t-foreach="doc.sale_id.order_line" t-as="l">
                                        <t t-if="l.is_decond">
                                            <span t-field="l.price_subtotal_net"
                                                  t-options='{"widget": "monetary", "display_currency": doc.sale_id.pricelist_id.currency_id}'/>
                                        </t>
                                    </t>
                                </t>

                            </td>

                            <!-- TOTAL HT NET -->
                            <td>
                                <t t-if="doc.sale_id">
                                    <span t-field="doc.sale_id.amount_ht_net"
                                      t-options='{"widget": "monetary", "display_currency": doc.sale_id.pricelist_id.currency_id}'/>
                                </t>

                            </td>

                            <!-- taxes.. ??? -->
                            <td>
                                <t t-if="doc.sale_id">
                                    <t t-foreach="doc.sale_id._get_tax_amount_by_group()" t-as="amount_by_group">
                                        <span t-esc="amount_by_group[0]" />
                                    </t>
                                </t>
                            </td>

                            <!-- montant tva -->
                            <td>
                                <t t-if="doc.sale_id">
                                    <span t-field="doc.sale_id.amount_tax"
                                          t-options='{"widget": "monetary", "display_currency": doc.sale_id.currency_id}'/>
                                </t>
                            </td>
                            <!-- <td style="white-space: nowrap;"> -->
                            <td>
                                <t t-if="doc.sale_id">
                                    H.T. :
                                    <span t-field="doc.sale_id.amount_untaxed"
                                          t-options='{"widget": "monetary", "display_currency": doc.sale_id.pricelist_id.currency_id}'/>
                                    <br/>
                                    T.V.A. :
                                    <span t-field="doc.sale_id.amount_tax"
                                          t-options='{"widget": "monetary", "display_currency": doc.sale_id.pricelist_id.currency_id}'/>
                                    <br/>
                                </t>
                            </td>
                            <td>
                                <t t-if="doc.sale_id">
                                    <span t-field="doc.sale_id.amount_total"
                                          t-options='{"widget": "monetary", "display_currency": doc.sale_id.pricelist_id.currency_id}'/>
                                </t>
                            </td>
                        </tr>
                    </tbody>
                </table>


                <div class="row">
                    <div class="col-xs-6">
                        Remarque :
                    </div>

                    <div class="col-xs-6">
                        NB LIVRAISON :
                        <t t-if="doc.partner_id.horaires_livraison">
                            <span t-field="doc.partner_id.horaires_livraison"/>
                        </t>
                        <t t-else="">
                            <span t-field="doc.partner_id.parent_id.horaires_livraison"/>
                        </t>

                    </div>
                </div>

                <div class="bl-spacer-div"></div>

                <!-- summary table -->
                <div class="row bl-summary-line">
                    <t t-set="err_mess">
                        <p> Odoo n'est pas configuré pour la gestion des colis. </p>
                    </t>
                    <div class="col-xs-4">
                        <!--
                        <t t-if=" 'package_ids' in doc.fields_get() ">
                            <p> Nombre de carton : <span t-esc="len(doc.package_ids.ids)"/> </p>
                        </t> -->
                        <t t-if=" 'nb_cartons' in doc.fields_get() ">
                            <p> Nombre de cartons : <span t-esc="doc.nb_cartons"/> </p>
                        </t>
                        <t t-else="">
                            <t t-raw="err_mess" /> <p>(champ package_ids inexistant)</p>
                        </t>
                        <!--<p> Nombre de carton : <span t-field="doc.package_ids"/> </p>-->
                    </div>
                    <div class="col-xs-4">
                        <p> Total Quantité : <span t-esc="'%.2f'%(sum([x.quantity_done for x in doc.move_lines]))"/> </p>
                    </div>
                    <div class="col-xs-4">
                        <t t-if=" 'shipping_weight' in doc.fields_get() ">
                            <p> Total Poids Brut : <span t-field="doc.shipping_weight"/> <span t-field="doc.weight_uom_id"/> </p>
                        </t>
                        <t t-else="">
                            <t t-raw="err_mess" /> <p>(champ shipping_weight inexistant)</p>
                        </t>
                    </div>
                </div>

                <div class="row">
                    <div class="col-xs-12">
                        <p class="invoice-warning-two">
                            La présente vente est conclue en application des conditions générales de vente figurant au verso du document
                        </p>
                    </div>
                </div>

            </div>
        </t>
    </template>

    <template id="dom_report_bl_valo">
        <t t-call="web.html_container">
            <t t-set="bl" t-value="True"/>
            <t t-foreach="docs" t-as="doc">
                <t t-call="dom_reports.dom_report_bl_document_valo" t-lang="doc.partner_id.lang"/>
            </t>
        </t>
    </template>

</odoo>
